<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 
 <link rel="stylesheet" href="./css/custom-theme-a.css">
 <link rel="stylesheet" href="./css/jquery.mobile.icons.min.css">
 <link rel="stylesheet" href="./css/button.css">
 
 <link rel="stylesheet" href="css/jquery.mobile.structure-1.4.3.min.css" />
 <link rel="stylesheet" type="text/css" href="./css/style-added.css" />
  
 <script src="javascript/jquery-1.11.1.min.js"></script>
 <script src="javascript/jquery.mobile-1.4.3.min.js"></script>
 
 <script>     
 
 
 var screen="big";
 $(window).resize(function() {
  // Mobile size
  if (window.matchMedia('(max-width: 40em)').matches) {
    if (screen=="mobile") {
      console.log("Screen type already mobile");
    } else{
      var new_navbar = '<div data-role="navbar" id="header-navbar"></div>';
      $("#pageone-header").append($(new_navbar));
      $("#navlist").clone(true).appendTo("#header-navbar");
      // This cloning seems to drop some of the href links unless I refresh and reload the initial tab
      $("#pageone-tabs").tabs("refresh");
      $("#pageone-tabs").tabs("load",0);
      $("#header-navbar").navbar();
      //$("#nav").remove();
      screen="mobile";
    }  
  }
  
  // Desktop Size
  if (window.matchMedia('(min-width: 41em)').matches) {
    if (screen=="mobile") {
      //new_nav = '<div data-role="nav" id="nav"></div>';
      //$(new_nav).insertAfter("#openstack-badge");
      //$("#navlist").clone(true).appendTo("#nav");
      $("#header-navbar").remove();
      screen="big";
    } else {
      console.log("Screen type already big");
      $("#pageone-tabs").create
      $("#pageone-tabs").tabs("refresh");
      $("#pageone-tabs").tabs("load",0);
    }
  }
  
  
 });
 </script>
  <title></title>
  </head>
  
  <body>
  <div data-role="page" id="pageone" data-theme=a>
    
    <div data-role="tabs" id="pageone-tabs" class="tabs">
      <div data-role="header" id="pageone-header" class="divh_cust left">
	<!-- Cool.. adds a "Home Button", not really useful in this app
	    <a href="#" class="ui-btn ui-corner-all ui-shadow ui-icon-home ui-btn-icon-left">Home</a>
	    -->
	<h1 class="left" id="pageone-title">OpenStack IaaS Dashboard</h1>
  
	<!-- A temp navbar, we'll add the navbar from the side when the screen is small
	<div data-role="navbar" id="pageone-navbar">
	</div> -->
      </div>
    
      <div data-role"main" id="pageone-main">
	<div id="right-nav" class="right">
	  <p id="openstack-badge">
	    <img src=resources/download-openstack-badge.png>
	  </p>
  
	  <div data-role="nav" id="nav">
	    <ul id="navlist">
	      <li><a href="rest/openstack/serverDetails" id="active-inst-button" data-role="button">Active VMs</a></li>
	      <li><a href="ajax/create_insts.html" id="create-vms-button" data-role="button">Launch New Services</a></li>
	      <li><a href="#other" data-role="button" id="other-stuff-button" data-ajax="false">Other Features</a></li>
	    </ul>
	  </div>
	  
	  <div id="email">
	    <span>Contact:<br></span>
	    <span class="email" id="email1"><a href=ocbrewing@gmail.com>Jason Rogers</a></span><br>
	    <span class="email" id="email2"><a href=blah@blah.gmail.com>Jijo Xavier</a></span><br>
	    <span class="email" id="email3"><a href=hugh@gmail.com>Hugh Ma</a></span><br>
	    <span class="email" id="email4"><a href=sweer@gmail.com>Sweer Kaul</a></span><br>
	    <span class="email" id="email5"><a href=soumya@gmail.com>Soumya Acharya</a></span><br>
	  </div>
	</div> <!-- End of Right Nav -->
	

	<div id="left-content" class="ui-body-d ui-content left">
	
	  <!-- Placeholder Divs to put the Tabs HTML -->
	  <div id="ui-tabs-1" class="ui-content left"></div>

	  <div id="ui-tabs-2" class="ui-content left"></div>
	    
	  <div id="other" class="ui-content left">
	    <table data-role="table" id="vm-table" class="vm_list ui-responsive" data-mode="columntoggle">
	    <thead id="vm_table_head">
	      <tr>
		<th>Other</th>
		<th data-priority="10"><a href="ajax/dialog.html">Image Name</a></th>
		<th data-priority=9">IP Address</th>
		<th data-priority="8">Size</th>
		<th data-priority="7">Key Pair</th>
		<th data-priority="6">Status</th>
		<th data-priority="5">Availability Zone</th>
		<th data-priority="4">Task</th>
		<th data-priority="3">Power State</h>
		<th data-priority="2">Uptime</th>
		<th data-priority="1">Actions</th>
	      </tr>
	    </thead>
	    <tbody>
	      <tr>
		<td>A</td>
		<td>B</td>
		<td>C</td>
		<td>D</td>
		<td>E</td>
		<td>F</td>
		<td>G</td>
		<td>H</td>
		<td>I</td>
		<td>J</td>
		<td>K</td>
	      </tr>
	      <tr>
		<td>A</td>
		<td>B</td>
		<td>C</td>
		<td>D</td>
		<td>E</td>
		<td>F</td>
		<td>G</td>
		<td>H</td>
		<td>I</td>
		<td>J</td>
		<td>K</td>
	      </tr>
	      <tr>
		<td>A</td>
		<td>B</td>
		<td>C</td>
		<td>D</td>
		<td>E</td>
		<td>F</td>
		<td>G</td>
		<td>H</td>
		<td>I</td>
		<td>J</td>
		<td>K</td>
	      </tr>
	    </tbody>
	  </table>	
	  </div>   <!-- End of Other Table -->
	</div>   <!-- End of left main content for tab display -->
      
      </div> <!-- End of Main -->
    </div>  <!-- End of Tabs -->
  
    <div data-role="footer" id="pageone-footer">
      <h1 id="ip">OpenStack IP:</h1>
    </div>
  </div>  <!-- End of Page -->
  
  <script>
  //var map = new Object();
  var buttonHtml="";
    var dom_test = "Testing The Scope of a Dialog";        
    $("#pageone-tabs").tabs({
          create: function(event, ui) {
	    console.log("Creation called");
	  },
	  beforeLoad: function(event, ui) {
            var url = ui.ajaxSettings.url;
	    var table_html = "<table id=\"dynamic-table\" class=\"vm_list ui-responsive\" data-role=\"table\">";
	    var table_head = "<thead>";
	    var table_body = "<tbody>";
	   // html="<html lang=\"en\"><head><meta charset=\"utf-8\"><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">"
	   // 	  +"<link rel=\"stylesheet\" type=\"text/css\" href=\"css/customButton.css\">"
	   // 	  +"<\/head><body>" ;
	   // var serverId ;
	    if (url =="rest/openstack/serverDetails") {
	      console.log("Need to load and parse JSON");
	      console.log(ui.ajaxSettings);
		   $.ajax({url:url,success:function(data){
				//nested each - first is the array of json, second is json itself
				var row_index=0;
				var serverID;
				var start;
				var stop;
				$.each(data.serverList, function(index, value) {
				  table_body+="<tr>\n"; //form new row for each array index
				  var counter=1;
				  stop = false;
				  start = false;
				  $.each(value, function(index2, value2) {
					 // buttonHtml ="";
				    if (index==0) {  //only fill header from first element
				      table_head+=("<th data-priority=\""+counter+"\">"+index2+"</th>");
				      counter+=counter;
				    }
				    if(index2 == "id"){
				    	table_body+=("<td><a href=\"#\" onclick=\"openWindow()\">"+value2+"</a></td>");
				    	//html+=("<div id="+value2+" class=\"container\">");
				    	//html+=("<tr><td><lebel>Server ID:"+value2+"</lebel></td>")
				    	serverID = value2;
				    }else if(index2 == "name"){
				    	table_body+=("<td>"+value2+"</td>");
				    	//html+=("<td><lebel>Server Name:"+value2+"</lebel></td>")
				    }
				    else if(index2 == "image"){
				    	table_body+=("<td>"+"Name:"+value2.imageName+"\n"+"Id:"+value2.id+"</td>");
				    }else if(index2 == "flavor"){
				    	table_body+=("<td>"+"Name:"+value2.flavourName+"\n"+"Id:"+value2.flavorId+"</td>");
				    }else if(index2 == "status"){
				    	table_body+=("<td>"+value2+"</td>");
				      if(value2 =="ACTIVE"){
				    	  //html+=("<td><button id="+serverID+"  class=\"button active\">Stop</button></td>");
				    	  //buttonHtml+=("<div class=\"button button-red\">Stop!</div>");
				    	  stop = true;
				      }
				      if(value2 =="UNRECOGNIZED"){
				    	 start = true;
				      }
				    }
				    else{
				      table_body+=("<td>"+value2+"</td>");
				    }

				  });
				 if(start == true){
					 table_body+=("<td><button type=\"button\" id="+serverID+" onClick=\"reply_click(this.id)\" value=\"Start\" class=\"btnstop\">Start!</div></button>");
				 }
				 if(stop ==true){
					 table_body+=("<td><button type=\"button\" id="+serverID+" onClick=\"reply_click(this.id)\" value=\"Stop\" class=\"btnstart\">Stop!</div></button>");
				 }
				  table_body+="</tr>\n";
				});
				table_head+="</thead>";
				table_body+="</tbody>";
				// html+="</body></html>";
				//console.log(html);
				table_html=table_html.concat(table_head, table_body, "</table>");
				//console.log("Full table markup "+table_html);
				ui.panel.html(table_html);
				$("#dynamic-table").table();
			    }});
	      console.log("Returning false");
	      return false;
	    } else {
	      console.log("No need to parse JSON");
	    }
	  return true;
	  }
    }); 
    $(document).ready(function(){
    	$(window).trigger('resize');
    });
   function reply_click(server_id) {
				//alert(clicked_id);
				var action = $("#"+server_id).val();
				//alert(button_val);
				var requesturl ="rest/openstack/doaction?&server_id="+server_id+"&action="+action+"&";
				   $.ajax({url:requesturl,success:function(data){
					   alert(data);
					    }});			
			}
		</script>
  </body>
</html>